"use strict";var canvas,cw,ch,boxSize,menuVisible=!0;function getRndInteger(t,e){return Math.floor(Math.random()*(e-t+1))+t}function setupInteraction(){document.querySelector("#grid-size").addEventListener("input",function(t){updateGrid(),t.target.setAttribute("value",t.target.value),t.target.setAttribute("aria-valuenow",t.target.value),document.querySelector("#grid-size-readout").innerHTML=t.target.value},!1),document.querySelector(".autoplay-toggle").addEventListener("click",function(t){t.target.blur();var e=t.target.value;("off"==e&&autoPlayIndicator||"on"==e&&!autoPlayIndicator)&&(toggleAutoplay(),updateToggleStatus(t))},!1);for(var t=document.querySelectorAll(".color-selectors"),e=0;e<t.length;e++)t[e].addEventListener("change",function(t){setBoxColors(),t.target.setAttribute("value",t.target.value)},!1);document.querySelector("#save-btn").addEventListener("click",function(t){savePattern(),t.target.blur()},!1),document.querySelector("#menu-toggle-btn").addEventListener("click",function(t){toggleControlPanel()},!1),document.addEventListener("keydown",function(t){"Tab"===t.key&&(console.log("tab key man"),document.body.classList.add("user-is-tabbing")),"Shift"===t.key&&toggleControlPanel(),"r"===t.key.toLowerCase()&&boxes[activeBox].spin(),"c"===t.key.toLowerCase()&&boxes[activeBox].changeColor(),"q"===t.key.toLowerCase()&&randomizeBoxes()},!1)}function updateToggleStatus(t){for(var e=document.querySelectorAll(".toggle"),o=0;o<e.length;o++)e[o].classList.remove("selected");t.target.classList.add("selected")}function toggleControlPanel(){console.log("control panel toggle");var t=document.querySelector("#controls-container"),e=document.querySelector("#control-panel-toggle"),o=document.querySelector("#menu-toggle-btn");menuVisible=menuVisible?(t.classList.remove("cp-visible"),t.classList.add("cp-hidden"),e.classList.remove("cp-toggle-max"),e.classList.add("cp-toggle-min"),!(o.innerHTML="Menu &rarr;")):(t.classList.remove("cp-hidden"),t.classList.add("cp-visible"),e.classList.remove("cp-toggle-min"),e.classList.add("cp-toggle-max"),o.innerHTML="&larr; Hide",!0)}function setup(){cw=window.innerWidth,ch=window.innerHeight,(canvas=createCanvas(cw,ch)).parent("pattern-container"),rectMode(CENTER),noStroke(),angleMode(DEGREES),initBoxes()}function mouseClicked(){boxes[activeBox].flip()}function draw(){for(var t=0;t<boxes.length;t++)boxes[t].xId<=xCount&&boxes[t].yId<=yCount&&(boxes[t].display(),boxes[t].hoverCheck());autoPlayIndicator&&autoPlay()}function windowResized(){cw=window.innerWidth,ch=window.innerHeight,canvas=createCanvas(cw,ch),initBoxes()}function savePattern(){saveCanvas(canvas,"my_wonderful_pattern","jpg")}window.onload=function(){setupInteraction()},window.onload=function(){setupInteraction()};var autoPlayIndicator=!0,autoPlayDuration=50,autoPlayTimer=autoPlayDuration;function toggleAutoplay(){autoPlayIndicator=!autoPlayIndicator}function autoPlay(){if(--autoPlayTimer<=0){for(var t;t=getRndInteger(0,boxes.length-1),1==boxes[t].toggled&&boxes[t].xId>xCount&&boxes[t].yId>yCount;);var e=getRndInteger(0,totalStates-1),o=boxRotation[getRndInteger(0,boxRotation.length-1)],n=getRndInteger(0,patternColors.length-1);boxes[t].pState=e,boxes[t].rState=o,boxes[t].cId=n,autoPlayTimer=autoPlayDuration}}var previousBoxValues,bgColor,xCount,yCount,totalXCount,totalYCount,boxes=[],totalStates=5,boxRotation=[0,90,180,270],patternColors=[],activeBox=0;function initBoxes(){calcGrid(),setBoxColors(),createBoxes()}function calcGrid(){boxSize=document.querySelector("#grid-size").value;totalXCount=Math.ceil(window.innerWidth/80),totalYCount=Math.ceil(window.innerHeight/80),xCount=Math.ceil(window.innerWidth/boxSize),yCount=Math.ceil(window.innerHeight/boxSize)}function updateGrid(){calcGrid();for(var t=0,e=0;e<totalXCount;e++)for(var o=0;o<totalYCount;o++){var n=boxSize/2+e*boxSize,a=boxSize/2+o*boxSize;boxes[t].x=n,boxes[t].y=a,boxes[t].s=boxSize,t++}}function setBoxColors(){var t=document.querySelector("#bg-color"),e=document.querySelector("#shape-color-01"),o=document.querySelector("#shape-color-02"),n=document.querySelector("#shape-color-03");bgColor=t.value,patternColors[0]=e.value,patternColors[1]=o.value,patternColors[2]=n.value}function createBoxes(){for(var t=0,e=0;e<totalXCount;e++)for(var o=0;o<totalYCount;o++){var n=boxSize/2+e*boxSize,a=boxSize/2+o*boxSize,i=boxRotation[getRndInteger(0,boxRotation.length-1)],s=getRndInteger(0,patternColors.length-1);boxes[t]=new Box(n,a,boxSize,i,s,t,e,o),t++}}function randomizeBoxes(){for(var t=0;t<boxes.length;t++)boxes[t].pState=getRndInteger(0,totalStates-1),boxes[t].rState=boxRotation[getRndInteger(0,boxRotation.length-1)],boxes[t].cId=getRndInteger(0,patternColors.length-1)}function Box(t,e,o,n,a,i,s,r){this.x=t,this.y=e,this.s=o,this.pState=0,this.rState=n,this.hover=!1,this.cId=a,this.id=i,this.xId=s,this.yId=r,this.toggled=!1}Box.prototype.display=function(){push(),translate(this.x,this.y),fill(bgColor),rect(0,0,this.s,this.s),this.hover&&(push(),colorMode(RGB,255,255,255,100),"ffffff"==bgColor?fill(0,0,0,20):fill(255,255,255,30),rect(0,0,this.s,this.s),pop()),fill(patternColors[this.cId]),rotate(this.rState);var t=this.s/2,e=this.s/4;1===this.pState?arc(0,-t,this.s,this.s,0,180,PIE):2===this.pState?(arc(-t,-t,this.s,this.s,0,90,PIE),arc(t,t,this.s,this.s,180,270,PIE)):3===this.pState?(arc(0,-t,this.s,this.s,0,180,PIE),arc(0,t,this.s,this.s,180,360,PIE)):4===this.pState?arc(-t,-t,2*this.s,2*this.s,0,90,PIE):5===this.pState&&(rect(e,0,this.s/2,this.s),arc(0,0,this.s,this.s,90,270,PIE)),pop()},Box.prototype.hoverCheck=function(){var t=this.s/2;mouseX>this.x-t&&mouseX<this.x+t&&mouseY>this.y-t&&mouseY<this.y+t?(this.hover=!0,activeBox=this.id):this.hover=!1},Box.prototype.flip=function(){0==this.pState&&(this.toggled=!0),this.pState++,this.pState>totalStates&&(this.pState=0,this.spin(),this.changeColor(),this.toggled=!1)},Box.prototype.spin=function(){this.rState+=90,this.toggled||(this.toggled=!0)},Box.prototype.changeColor=function(){this.cId++,this.cId>patternColors.length-1&&(this.cId=0),this.toggled||(this.toggled=!0)};